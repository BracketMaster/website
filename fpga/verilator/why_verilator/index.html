<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="another hardware blog"><link href=https://yehowshuaimmanuel.com/fpga/verilator/why_verilator/ rel=canonical><meta name=author content="Yehowshua Immanuel"><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.6.3"><title>why verilator - planet program</title><link rel=stylesheet href=../../../assets/stylesheets/application.8c7b2d21.css><link rel=stylesheet href=../../../assets/stylesheets/application-palette.6fba2f6a.css><meta name=theme-color content=#fb8c00><script src=../../../assets/javascripts/modernizr.eca31fed.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,400i,700%7CUbuntu+Mono&display=fallback"><style>body,input{font-family:"Ubuntu","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../../assets/fonts/material-icons.css><script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-144903341-1", "yehowshuaimmanuel.com")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-primary=orange data-md-color-accent=indigo> <svg class=md-svg> <defs> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#simulating-verilog-the-right-way tabindex=0 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://yehowshuaimmanuel.com/ title="planet program" aria-label="planet program" class="md-header-nav__button md-logo"> <i class=md-icon>videogame_asset</i> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> planet program </span> <span class=md-header-nav__topic> why verilator </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input aria-label=search name=query placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> home </a> </li> <li class=md-tabs__item> <a href=../../ class="md-tabs__link md-tabs__link--active"> hardware hacking </a> </li> <li class=md-tabs__item> <a href=../../../mathematics/loss_function_gradient_derivation/ class=md-tabs__link> mathematics </a> </li> <li class=md-tabs__item> <a href=../../../computing_culture/intro/ class=md-tabs__link> blog </a> </li> <li class=md-tabs__item> <a href=../../../Bible/Ezekiel/3/ class=md-tabs__link> bible notes </a> </li> </ul> </div> </nav> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://yehowshuaimmanuel.com/ title="planet program" class="md-nav__button md-logo"> <i class=md-icon>videogame_asset</i> </a> planet program </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <label class=md-nav__link for=nav-1> home </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-1> home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. title=home class=md-nav__link> home </a> </li> <li class=md-nav__item> <a href=../../../about/ title="about me" class=md-nav__link> about me </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-1-3 type=checkbox id=nav-1-3> <label class=md-nav__link for=nav-1-3> my setup </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-1-3> my setup </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../my_setup/hardware/ title=hardware class=md-nav__link> hardware </a> </li> <li class=md-nav__item> <a href=../../../my_setup/software/ title=software class=md-nav__link> software </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2 checked> <label class=md-nav__link for=nav-2> hardware hacking </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> hardware hacking </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ title="getting started" class=md-nav__link> getting started </a> </li> <li class=md-nav__item> <a href=../../vhdl/getting_started_with_vhdl/ title="FOSS intro to VHDL" class=md-nav__link> FOSS intro to VHDL </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-3 type=checkbox id=nav-2-3 checked> <label class=md-nav__link for=nav-2-3> fpga fun </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-3> fpga fun </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../hdl_wars/ title="hdl wars" class=md-nav__link> hdl wars </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-3-2 type=checkbox id=nav-2-3-2> <label class=md-nav__link for=nav-2-3-2> migen </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-3-2> migen </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../migen/why_migen/ title="why migen" class=md-nav__link> why migen </a> </li> <li class=md-nav__item> <a href=../../migen/ethernet_ecp5/ title="ethernet on ECP5" class=md-nav__link> ethernet on ECP5 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-3-3 type=checkbox id=nav-2-3-3 checked> <label class=md-nav__link for=nav-2-3-3> verilator </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-3-3> verilator </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> why verilator </label> <a href=./ title="why verilator" class="md-nav__link md-nav__link--active"> why verilator </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#simulating-verilog-the-right-way class=md-nav__link> Simulating Verilog the Right Way </a> </li> <li class=md-nav__item> <a href=#verilator-to-the-rescue class=md-nav__link> Verilator to the Rescue </a> </li> <li class=md-nav__item> <a href=#simulating-with-verilator class=md-nav__link> Simulating with Verilator </a> </li> <li class=md-nav__item> <a href=#building-and-running-your-testbench class=md-nav__link> Building and Running Your Testbench </a> </li> <li class=md-nav__item> <a href=#example-testbench class=md-nav__link> Example Testbench </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#snippet-from-maincpp class=md-nav__link> Snippet from main.cpp </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../some_notes_on_verilator/ title="some notes on verilator" class=md-nav__link> some notes on verilator </a> </li> <li class=md-nav__item> <a href=../dpi/ title="verilator as a nMigen Python backend" class=md-nav__link> verilator as a nMigen Python backend </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4 type=checkbox id=nav-2-4> <label class=md-nav__link for=nav-2-4> vintage tech projects </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-4> vintage tech projects </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Vintage_Tech/ title="hacking old tech" class=md-nav__link> hacking old tech </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4-2 type=checkbox id=nav-2-4-2> <label class=md-nav__link for=nav-2-4-2> my classic mac </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-4-2> my classic mac </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Vintage_Tech/My_Mac_SE/ title="acquisition and ideas" class=md-nav__link> acquisition and ideas </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4-3 type=checkbox id=nav-2-4-3> <label class=md-nav__link for=nav-2-4-3> gt retrotech </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-4-3> gt retrotech </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Vintage_Tech/retrotech/my_setup/ title="my setup" class=md-nav__link> my setup </a> </li> <li class=md-nav__item> <a href=../../../Vintage_Tech/retrotech/first_steps/ title="first steps" class=md-nav__link> first steps </a> </li> <li class=md-nav__item> <a href=../../../Vintage_Tech/retrotech/la_inspection/ title="la bus inpection" class=md-nav__link> la bus inpection </a> </li> <li class=md-nav__item> <a href=../../../Vintage_Tech/retrotech/why_an_fpga/ title="why an fpga?" class=md-nav__link> why an fpga? </a> </li> <li class=md-nav__item> <a href=../../../Vintage_Tech/retrotech/crt_smoke_test/ title="crt smoke test" class=md-nav__link> crt smoke test </a> </li> <li class=md-nav__item> <a href=../../../Vintage_Tech/retrotech/fpga_logic_analyzer/ title="fpga logic analyzer" class=md-nav__link> fpga logic analyzer </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> mathematics </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> mathematics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../mathematics/loss_function_gradient_derivation/ title="loss function gradient derivation" class=md-nav__link> loss function gradient derivation </a> </li> <li class=md-nav__item> <a href=../../../mathematics/EMAG_HW3/EMAG_HW3/ title="goodbye matlab, hello python with emag examples" class=md-nav__link> goodbye matlab, hello python with emag examples </a> </li> <li class=md-nav__item> <a href=../../../mathematics/matlabs_very_real_problems/ title="Matlab's very real problems" class=md-nav__link> Matlab's very real problems </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> blog </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> blog </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../computing_culture/intro/ title="looking to the future" class=md-nav__link> looking to the future </a> </li> <li class=md-nav__item> <a href=../../../computing_culture/on_open_source/ title="thoughts on open source" class=md-nav__link> thoughts on open source </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> bible notes </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> bible notes </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-1 type=checkbox id=nav-5-1> <label class=md-nav__link for=nav-5-1> Ezekiel </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-1> Ezekiel </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Bible/Ezekiel/3/ title="Chapter 3" class=md-nav__link> Chapter 3 </a> </li> <li class=md-nav__item> <a href=../../../Bible/Ezekiel/13/ title="Chapter 13" class=md-nav__link> Chapter 13 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> Matthew </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-2> Matthew </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Bible/Matthew/4/ title="Chapter 4" class=md-nav__link> Chapter 4 </a> </li> <li class=md-nav__item> <a href=../../../Bible/Matthew/13/ title="Chapter 13" class=md-nav__link> Chapter 13 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> John </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-3> John </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Bible/John/15/ title="Chapter 15" class=md-nav__link> Chapter 15 </a> </li> <li class=md-nav__item> <a href=../../../Bible/John/17/ title="Chapter 17" class=md-nav__link> Chapter 17 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-4 type=checkbox id=nav-5-4> <label class=md-nav__link for=nav-5-4> Romans </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-4> Romans </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Bible/Romans/1/ title="Chapter 1" class=md-nav__link> Chapter 1 </a> </li> <li class=md-nav__item> <a href=../../../Bible/Romans/3/ title="Chapter 3" class=md-nav__link> Chapter 3 </a> </li> <li class=md-nav__item> <a href=../../../Bible/Romans/4/ title="Chapter 4" class=md-nav__link> Chapter 4 </a> </li> <li class=md-nav__item> <a href=../../../Bible/Romans/6/ title="Chapter 6" class=md-nav__link> Chapter 6 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-5 type=checkbox id=nav-5-5> <label class=md-nav__link for=nav-5-5> Peter </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-5> Peter </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Bible/Peter/1/ title="Chapter 1" class=md-nav__link> Chapter 1 </a> </li> <li class=md-nav__item> <a href=../../../Bible/Peter/5/ title="Chapter 5" class=md-nav__link> Chapter 5 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-6 type=checkbox id=nav-5-6> <label class=md-nav__link for=nav-5-6> 2 Peter </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-6> 2 Peter </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Bible/2_Peter/2/ title="Chapter 2" class=md-nav__link> Chapter 2 </a> </li> <li class=md-nav__item> <a href=../../../Bible/2_Peter/3/ title="Chapter 3" class=md-nav__link> Chapter 3 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-7 type=checkbox id=nav-5-7> <label class=md-nav__link for=nav-5-7> Revelation </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-7> Revelation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Bible/Revelation/5/ title="Chapter 1" class=md-nav__link> Chapter 1 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#simulating-verilog-the-right-way class=md-nav__link> Simulating Verilog the Right Way </a> </li> <li class=md-nav__item> <a href=#verilator-to-the-rescue class=md-nav__link> Verilator to the Rescue </a> </li> <li class=md-nav__item> <a href=#simulating-with-verilator class=md-nav__link> Simulating with Verilator </a> </li> <li class=md-nav__item> <a href=#building-and-running-your-testbench class=md-nav__link> Building and Running Your Testbench </a> </li> <li class=md-nav__item> <a href=#example-testbench class=md-nav__link> Example Testbench </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#snippet-from-maincpp class=md-nav__link> Snippet from main.cpp </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1>why verilator</h1> <h2 id=simulating-verilog-the-right-way>Simulating Verilog the Right Way<a class=headerlink href=#simulating-verilog-the-right-way title="Permanent link">&para;</a></h2> <p>Simulating verilog in an effective manner can be a challenging task. The verilog language provides a few structures for allowing the HDL designer to describe a small testbench effectively - but is rather inadequate for complex designs. Such shortcomings become extremely painful in large complex design such as verifying and pipelining and Out of Order CPU.</p> <h2 id=verilator-to-the-rescue>Verilator to the Rescue<a class=headerlink href=#verilator-to-the-rescue title="Permanent link">&para;</a></h2> <p>Verilator allows you to compile your Verilog source into C++ code. Suddenly, anything that you can do with C++/C, you can do with your RTL. For example, if you have RTL that has video output, you can use verilator to display that video output within your windowing system via the X Windowing System for example.</p> <p>Also, the last time I checked, verilator was the fastest verilog simulator on the market.</p> <h2 id=simulating-with-verilator>Simulating with Verilator<a class=headerlink href=#simulating-with-verilator title="Permanent link">&para;</a></h2> <p>Simulating with verilator directly by writing C++ can quickly become tiring for large designs. While C++ is a much better language for describing simulations, describing multi port hardware accesses with C++ syntax is a bit unpleasant. To help combat this, it is possible to use verilator to simulate hardware written in <a href=https://www.chisel-lang.org>Chisel HDL</a> or <a href=https://spinalhdl.github.io/SpinalDoc-RTD/ >Spinal HDL</a> as verilator is integrated as a simulation backend in both Spinal and Chisel HDL. </p> <h2 id=building-and-running-your-testbench>Building and Running Your Testbench<a class=headerlink href=#building-and-running-your-testbench title="Permanent link">&para;</a></h2> <p>While you can write your testbench in Chisel or Spinal and invoke verilator as a backend(the easier way of doing things), you may have verilog source code you have already written that you wish to test.</p> <p>Dan Gisselquist has a good <a href=https://zipcpu.com/blog/2017/06/21/looking-at-verilator.html>tutorial</a> on how to use verilator. Compiling with verilator has changed a little since his tutorial was written, in particular, to build your verilog into C++, you will probably need to do the following:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3</pre></div></td><td class=code><div class=codehilite><pre><span></span><code><span class=c1>#this compiles your verilog into C++</span>
<span class=c1>#main.cpp contains your testbench in C++</span>
<span class=nv>$verilator</span> -Wall --cc top.v submodule1.v submodule2.v submoduleN.v --exe main.cpp --Mdir /build --top-module top -Wno-fatal
</code></pre></div> </td></tr></table> <p>where <code>top</code> is the name of the top module in your verilog source. Verilator will automatically generate a makefile for you too. Invoking this makefile will build an executable that will simulate your design. You can also have verilator spit out a VCD. To build your executable, you do something along the lines of:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><code><span class=nv>$make</span> -j -C /build -f Vtop.mk Vtop
</code></pre></div> </td></tr></table> <h2 id=example-testbench>Example Testbench<a class=headerlink href=#example-testbench title="Permanent link">&para;</a></h2> <p>Here is a testbench i wrote a while back for verilator. The complete source is not shown below, but just enough to give you an idea of how verilator works.</p> <p>For this particular testbench, I was simulating a RISCV core that printed its status to a UART device.</p> <h3 id=snippet-from-maincpp>Snippet from main.cpp<a class=headerlink href=#snippet-from-maincpp title="Permanent link">&para;</a></h3> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64</pre></div></td><td class=code><div class=codehilite><pre><span></span><code><span class=c1>//here we do setup</span>
<span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>module</span><span class=o>&gt;</span>
<span class=kt>void</span> <span class=n>testbench</span><span class=o>&lt;</span><span class=n>module</span><span class=o>&gt;::</span><span class=n>setup</span><span class=p>(</span><span class=kt>void</span><span class=p>){</span>
    <span class=c1>//setup inputs</span>
    <span class=n>m_core</span><span class=o>-&gt;</span><span class=n>clk</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
    <span class=n>m_core</span><span class=o>-&gt;</span><span class=n>rx</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>

    <span class=n>m_core</span><span class=o>-&gt;</span><span class=n>eval</span><span class=p>();</span>
    <span class=n>m_core</span><span class=o>-&gt;</span><span class=n>clk</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
    <span class=n>m_core</span><span class=o>-&gt;</span><span class=n>eval</span><span class=p>();</span>
    <span class=n>m_core</span><span class=o>-&gt;</span><span class=n>clk</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
    <span class=n>m_core</span><span class=o>-&gt;</span><span class=n>eval</span><span class=p>();</span>

    <span class=c1>// Tick the clock until we are done</span>
    <span class=kt>int</span> <span class=n>OLD_LED</span> <span class=o>=</span> <span class=n>m_core</span><span class=o>-&gt;</span><span class=n>led</span><span class=p>;</span>
    <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>500000</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>){</span>
        <span class=n>m_core</span><span class=o>-&gt;</span><span class=n>clk</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
        <span class=n>m_core</span><span class=o>-&gt;</span><span class=n>eval</span><span class=p>();</span>
        <span class=n>m_core</span><span class=o>-&gt;</span><span class=n>clk</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
        <span class=n>m_core</span><span class=o>-&gt;</span><span class=n>eval</span><span class=p>();</span>

        <span class=k>if</span><span class=p>(</span><span class=n>m_core</span><span class=o>-&gt;</span><span class=n>tx_byte_valid</span><span class=p>){</span>
            <span class=c1>//printf(&quot;%s&quot;,(char)m_core-&gt;tx_byte);</span>
            <span class=n>putc</span><span class=p>(</span><span class=n>m_core</span><span class=o>-&gt;</span><span class=n>tx_byte</span><span class=p>,</span> <span class=n>stdout</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=k>if</span><span class=p>(</span><span class=n>m_core</span><span class=o>-&gt;</span><span class=n>led</span> <span class=o>!=</span> <span class=n>OLD_LED</span><span class=p>)</span>
            <span class=n>printf</span><span class=p>(</span><span class=s>&quot;LED VALUE: %d</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>,</span> <span class=p>(</span><span class=kt>char</span><span class=p>)</span><span class=n>m_core</span><span class=o>-&gt;</span><span class=n>led</span><span class=p>);</span>

        <span class=n>OLD_LED</span> <span class=o>=</span> <span class=n>m_core</span><span class=o>-&gt;</span><span class=n>led</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>module</span><span class=o>&gt;</span>
<span class=kt>void</span> <span class=n>testbench</span><span class=o>&lt;</span><span class=n>module</span><span class=o>&gt;::</span><span class=n>do_transmit</span><span class=p>(</span><span class=kt>void</span><span class=p>){</span>
<span class=p>}</span>

<span class=kt>void</span> <span class=n>delay</span><span class=p>(</span><span class=n>testbench</span><span class=o>&lt;</span><span class=n>Vtop</span><span class=o>&gt;</span> <span class=o>*</span><span class=n>tb</span><span class=p>){</span>
    <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>1250</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
        <span class=n>tb</span><span class=o>-&gt;</span><span class=n>tick</span><span class=p>();</span>
<span class=p>}</span>

<span class=kt>int</span> <span class=n>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>){</span>
    <span class=c1>// initialize verilators variables</span>
    <span class=n>Verilated</span><span class=o>::</span><span class=n>commandArgs</span><span class=p>(</span><span class=n>argc</span><span class=p>,</span> <span class=n>argv</span><span class=p>);</span>

    <span class=c1>// create an instance of our module under test</span>
    <span class=n>testbench</span><span class=o>&lt;</span><span class=n>Vtop</span><span class=o>&gt;</span> <span class=o>*</span><span class=n>tb</span> <span class=o>=</span> <span class=k>new</span> <span class=n>testbench</span><span class=o>&lt;</span><span class=n>Vtop</span><span class=o>&gt;</span><span class=p>();</span>
    <span class=c1>//toggle transmit informing the UART core we are</span>
    <span class=c1>//ready to transmit</span>

<span class=cp>#ifdef TRACE_ON</span>
    <span class=c1>//we&#39;ve reached a condition of interest in the simulation</span>
    <span class=c1>//we open the trace file to start recording</span>
    <span class=n>tb</span><span class=o>-&gt;</span><span class=n>opentrace</span><span class=p>(</span><span class=s>&quot;trace.vcd&quot;</span><span class=p>);</span>
    <span class=n>printf</span><span class=p>(</span><span class=s>&quot;tracing</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>
<span class=cp>#endif</span>

    <span class=n>printf</span><span class=p>(</span><span class=s>&quot;BEGIN SIM</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>
    <span class=n>tb</span><span class=o>-&gt;</span><span class=n>setup</span><span class=p>();</span>
    <span class=n>printf</span><span class=p>(</span><span class=s>&quot;</span><span class=se>\n</span><span class=s>END SIM</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>
<span class=cp>#ifdef TRACE_ON</span>
    <span class=n>tb</span><span class=o>-&gt;</span><span class=n>close</span><span class=p>();</span>
<span class=cp>#endif</span>
<span class=p>}</span>
</code></pre></div> </td></tr></table> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../../migen/ethernet_ecp5/ title="ethernet on ECP5" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Previous </span> ethernet on ECP5 </span> </div> </a> <a href=../some_notes_on_verilator/ title="some notes on verilator" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Next </span> some notes on verilator </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2016 - 2020 Yehowshua Immanuel </div> powered by <a href=https://www.mkdocs.org target=_blank rel=noopener>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../../assets/fonts/font-awesome.css> <a href=https://github.com/BracketMaster target=_blank rel=noopener title=github-alt class="md-footer-social__link fa fa-github-alt"></a> <a href=https://www.linkedin.com/in/yehowshua-immanuel/ target=_blank rel=noopener title=linkedin class="md-footer-social__link fa fa-linkedin"></a> </div> </div> </div> </footer> </div> <script src=../../../assets/javascripts/application.8e081faa.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>