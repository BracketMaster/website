<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="another hardware blog"><link href=https://yehowshuaimmanuel.com/fpga/migen/ethernet_ecp5/ rel=canonical><meta name=author content="Yehowshua Immanuel"><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.1, mkdocs-material-4.6.3"><title>ethernet on ECP5 - planet program</title><link rel=stylesheet href=../../../assets/stylesheets/application.8c7b2d21.css><link rel=stylesheet href=../../../assets/stylesheets/application-palette.6fba2f6a.css><meta name=theme-color content=#fb8c00><script src=../../../assets/javascripts/modernizr.eca31fed.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,400i,700%7CUbuntu+Mono&display=fallback"><style>body,input{font-family:"Ubuntu","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../../assets/fonts/material-icons.css><script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-144903341-1", "yehowshuaimmanuel.com")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-primary=orange data-md-color-accent=indigo> <svg class=md-svg> <defs> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#purpose tabindex=0 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://yehowshuaimmanuel.com/ title="planet program" aria-label="planet program" class="md-header-nav__button md-logo"> <i class=md-icon>videogame_asset</i> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> planet program </span> <span class=md-header-nav__topic> ethernet on ECP5 </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input aria-label=search name=query placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> home </a> </li> <li class=md-tabs__item> <a href=../../ class="md-tabs__link md-tabs__link--active"> hardware hacking </a> </li> <li class=md-tabs__item> <a href=../../../mathematics/elliptically_polarized_efield/efield/ class=md-tabs__link> mathematics </a> </li> <li class=md-tabs__item> <a href=../../../computing_culture/intro/ class=md-tabs__link> blog </a> </li> <li class=md-tabs__item> <a href=../../../Bible/Proverbs/14/ class=md-tabs__link> bible notes </a> </li> </ul> </div> </nav> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://yehowshuaimmanuel.com/ title="planet program" class="md-nav__button md-logo"> <i class=md-icon>videogame_asset</i> </a> planet program </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. title=home class=md-nav__link> home </a> </li> <li class=md-nav__item> <a href=../../../about/ title="about me" class=md-nav__link> about me </a> </li> <li class=md-nav__item> <a href=../../../my_setup/hardware/ title="hardware conf" class=md-nav__link> hardware conf </a> </li> <li class=md-nav__item> <a href=../../../my_setup/software/ title="software conf" class=md-nav__link> software conf </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5 checked> <label class=md-nav__link for=nav-5> hardware hacking </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> hardware hacking </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ title="getting started" class=md-nav__link> getting started </a> </li> <li class=md-nav__item> <a href=../../vhdl/getting_started_with_vhdl/ title="FOSS intro to VHDL" class=md-nav__link> FOSS intro to VHDL </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3 checked> <label class=md-nav__link for=nav-5-3> fpga fun </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-3> fpga fun </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../hdl_wars/ title="hdl wars" class=md-nav__link> hdl wars </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3-2 type=checkbox id=nav-5-3-2 checked> <label class=md-nav__link for=nav-5-3-2> migen </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-3-2> migen </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../why_migen/ title="why migen" class=md-nav__link> why migen </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> ethernet on ECP5 </label> <a href=./ title="ethernet on ECP5" class="md-nav__link md-nav__link--active"> ethernet on ECP5 </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#purpose class=md-nav__link> Purpose </a> </li> <li class=md-nav__item> <a href=#resources class=md-nav__link> Resources </a> </li> <li class=md-nav__item> <a href=#code class=md-nav__link> Code </a> </li> <li class=md-nav__item> <a href=#configuring-the-ethernet class=md-nav__link> Configuring the Ethernet </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#connected-to-internet-via-rj45 class=md-nav__link> Connected to Internet via RJ45 </a> </li> <li class=md-nav__item> <a href=#connected-to-internet-via-wi-fi class=md-nav__link> Connected to Internet via Wi-Fi </a> </li> <li class=md-nav__item> <a href=#configuring-the-arp-table class=md-nav__link> Configuring the ARP table </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#freebsdmacos class=md-nav__link> FreeBSD/MacOS </a> </li> <li class=md-nav__item> <a href=#linux class=md-nav__link> Linux </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#sending-and-receiving-packets class=md-nav__link> Sending and Receiving Packets </a> </li> <li class=md-nav__item> <a href=#debugging class=md-nav__link> Debugging </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3-3 type=checkbox id=nav-5-3-3> <label class=md-nav__link for=nav-5-3-3> verilator </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-3-3> verilator </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../verilator/why_verilator/ title="why verilator" class=md-nav__link> why verilator </a> </li> <li class=md-nav__item> <a href=../../verilator/some_notes_on_verilator/ title="some notes on verilator" class=md-nav__link> some notes on verilator </a> </li> <li class=md-nav__item> <a href=../../verilator/dpi/ title="verilator as a nMigen Python backend" class=md-nav__link> verilator as a nMigen Python backend </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-4 type=checkbox id=nav-5-4> <label class=md-nav__link for=nav-5-4> vintage tech projects </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-4> vintage tech projects </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Vintage_Tech/ title="hacking old tech" class=md-nav__link> hacking old tech </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-4-2 type=checkbox id=nav-5-4-2> <label class=md-nav__link for=nav-5-4-2> my classic mac </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-4-2> my classic mac </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Vintage_Tech/My_Mac_SE/ title="acquisition and ideas" class=md-nav__link> acquisition and ideas </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-4-3 type=checkbox id=nav-5-4-3> <label class=md-nav__link for=nav-5-4-3> gt retrotech </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-4-3> gt retrotech </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Vintage_Tech/retrotech/my_setup/ title="my setup" class=md-nav__link> my setup </a> </li> <li class=md-nav__item> <a href=../../../Vintage_Tech/retrotech/first_steps/ title="first steps" class=md-nav__link> first steps </a> </li> <li class=md-nav__item> <a href=../../../Vintage_Tech/retrotech/la_inspection/ title="la bus inpection" class=md-nav__link> la bus inpection </a> </li> <li class=md-nav__item> <a href=../../../Vintage_Tech/retrotech/why_an_fpga/ title="why an fpga?" class=md-nav__link> why an fpga? </a> </li> <li class=md-nav__item> <a href=../../../Vintage_Tech/retrotech/crt_smoke_test/ title="crt smoke test" class=md-nav__link> crt smoke test </a> </li> <li class=md-nav__item> <a href=../../../Vintage_Tech/retrotech/fpga_logic_analyzer/ title="fpga logic analyzer" class=md-nav__link> fpga logic analyzer </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> mathematics </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-6> mathematics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../mathematics/elliptically_polarized_efield/efield/ title="elliptically polarized electric field" class=md-nav__link> elliptically polarized electric field </a> </li> <li class=md-nav__item> <a href=../../../mathematics/loss_function_gradient_derivation/ title="loss function gradient derivation" class=md-nav__link> loss function gradient derivation </a> </li> <li class=md-nav__item> <a href=../../../mathematics/EMAG_HW3/EMAG_HW3/ title="goodbye matlab, hello python with emag examples" class=md-nav__link> goodbye matlab, hello python with emag examples </a> </li> <li class=md-nav__item> <a href=../../../mathematics/matlabs_very_real_problems/ title="Matlab's very real problems" class=md-nav__link> Matlab's very real problems </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7 type=checkbox id=nav-7> <label class=md-nav__link for=nav-7> blog </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-7> blog </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../computing_culture/intro/ title="looking to the future" class=md-nav__link> looking to the future </a> </li> <li class=md-nav__item> <a href=../../../computing_culture/on_open_source/ title="thoughts on open source" class=md-nav__link> thoughts on open source </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8 type=checkbox id=nav-8> <label class=md-nav__link for=nav-8> bible notes </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-8> bible notes </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1 type=checkbox id=nav-8-1> <label class=md-nav__link for=nav-8-1> Proverbs </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-1> Proverbs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Bible/Proverbs/14/ title="Chapter 14" class=md-nav__link> Chapter 14 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2 type=checkbox id=nav-8-2> <label class=md-nav__link for=nav-8-2> Ezekiel </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-2> Ezekiel </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Bible/Ezekiel/3/ title="Chapter 3" class=md-nav__link> Chapter 3 </a> </li> <li class=md-nav__item> <a href=../../../Bible/Ezekiel/13/ title="Chapter 13" class=md-nav__link> Chapter 13 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-3 type=checkbox id=nav-8-3> <label class=md-nav__link for=nav-8-3> Matthew </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-3> Matthew </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Bible/Matthew/4/ title="Chapter 4" class=md-nav__link> Chapter 4 </a> </li> <li class=md-nav__item> <a href=../../../Bible/Matthew/13/ title="Chapter 13" class=md-nav__link> Chapter 13 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-4 type=checkbox id=nav-8-4> <label class=md-nav__link for=nav-8-4> John </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-4> John </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Bible/John/15/ title="Chapter 15" class=md-nav__link> Chapter 15 </a> </li> <li class=md-nav__item> <a href=../../../Bible/John/17/ title="Chapter 17" class=md-nav__link> Chapter 17 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-5 type=checkbox id=nav-8-5> <label class=md-nav__link for=nav-8-5> Romans </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-5> Romans </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Bible/Romans/1/ title="Chapter 1" class=md-nav__link> Chapter 1 </a> </li> <li class=md-nav__item> <a href=../../../Bible/Romans/3/ title="Chapter 3" class=md-nav__link> Chapter 3 </a> </li> <li class=md-nav__item> <a href=../../../Bible/Romans/4/ title="Chapter 4" class=md-nav__link> Chapter 4 </a> </li> <li class=md-nav__item> <a href=../../../Bible/Romans/6/ title="Chapter 6" class=md-nav__link> Chapter 6 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-6 type=checkbox id=nav-8-6> <label class=md-nav__link for=nav-8-6> Peter </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-6> Peter </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Bible/Peter/1/ title="Chapter 1" class=md-nav__link> Chapter 1 </a> </li> <li class=md-nav__item> <a href=../../../Bible/Peter/5/ title="Chapter 5" class=md-nav__link> Chapter 5 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-7 type=checkbox id=nav-8-7> <label class=md-nav__link for=nav-8-7> 2 Peter </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-7> 2 Peter </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Bible/2_Peter/2/ title="Chapter 2" class=md-nav__link> Chapter 2 </a> </li> <li class=md-nav__item> <a href=../../../Bible/2_Peter/3/ title="Chapter 3" class=md-nav__link> Chapter 3 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-8 type=checkbox id=nav-8-8> <label class=md-nav__link for=nav-8-8> Revelation </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-8> Revelation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Bible/Revelation/5/ title="Chapter 1" class=md-nav__link> Chapter 1 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#purpose class=md-nav__link> Purpose </a> </li> <li class=md-nav__item> <a href=#resources class=md-nav__link> Resources </a> </li> <li class=md-nav__item> <a href=#code class=md-nav__link> Code </a> </li> <li class=md-nav__item> <a href=#configuring-the-ethernet class=md-nav__link> Configuring the Ethernet </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#connected-to-internet-via-rj45 class=md-nav__link> Connected to Internet via RJ45 </a> </li> <li class=md-nav__item> <a href=#connected-to-internet-via-wi-fi class=md-nav__link> Connected to Internet via Wi-Fi </a> </li> <li class=md-nav__item> <a href=#configuring-the-arp-table class=md-nav__link> Configuring the ARP table </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#freebsdmacos class=md-nav__link> FreeBSD/MacOS </a> </li> <li class=md-nav__item> <a href=#linux class=md-nav__link> Linux </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#sending-and-receiving-packets class=md-nav__link> Sending and Receiving Packets </a> </li> <li class=md-nav__item> <a href=#debugging class=md-nav__link> Debugging </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1>ethernet on ECP5</h1> <h2 id=purpose>Purpose<a class=headerlink href=#purpose title="Permanent link">&para;</a></h2> <p>This tutorial is intended to help gently introduce the reader to using LiteX+Migen on supported FPGAs with a simple UDP loopback over ethernet RJ45 example. </p> <p>A working understanding of Migen is required.</p> <p>At the end of this tutorial, the FPGA will form a UDP loopback echoing back UDP messages to the sender IP address and sender UDP port.</p> <p><img alt="title pic" src=../FPGA.jpg></p> <h2 id=resources>Resources<a class=headerlink href=#resources title="Permanent link">&para;</a></h2> <p>Here are some resources for getting up to speed on Migen.</p> <ul> <li><a href="http://blog.lambdaconcept.com/doku.php?id=migen:tutorial">Lambda Concepts Tutorial</a></li> <li><a href=https://github.com/timvideos/litex-buildenv/wiki/LiteX-for-Hardware-Engineers#csrs-config-and-status-registers>Github Migen Practical Intro</a></li> <li><a href=https://m-labs.hk/migen/manual/ >Migen Manual</a></li> </ul> <h2 id=code>Code<a class=headerlink href=#code title="Permanent link">&para;</a></h2> <p>First grab the code from <a href=https://github.com/enjoy-digital/liteeth/tree/master/examples/targets/udp_loopback>here</a>.</p> <pre class=codehilite><code class="language-bash linenums">$./udp.py build
#this programs the FPGA
$./udp.py load</code></pre> <h2 id=configuring-the-ethernet>Configuring the Ethernet<a class=headerlink href=#configuring-the-ethernet title="Permanent link">&para;</a></h2> <p>Your machine will obviously need to have an ethernet RJ45 jack. On my Mac, this usually means plugging in a Thunderbolt dongle.</p> <h3 id=connected-to-internet-via-rj45>Connected to Internet via RJ45<a class=headerlink href=#connected-to-internet-via-rj45 title="Permanent link">&para;</a></h3> <p>If you're connected to the internet via your RJ45 ethernet, you'll either have to disconnect from internet or plug both your FPGA and PC into an external router. The router approach is subtly more difficult as it will be necessary to manually configure the router's ARP table as this example comes with no ARP hardware.</p> <h3 id=connected-to-internet-via-wi-fi>Connected to Internet via Wi-Fi<a class=headerlink href=#connected-to-internet-via-wi-fi title="Permanent link">&para;</a></h3> <p>It is also possible you may be connected to internet via Wi-Fi. If this is the case, run <code>ifconfig</code> and verify that the most significant byte of the IP assigned to your ethernet interface differs from that assigned to your Wi-Fi interface. In this example, the FPGA is programmed to respond to the IP of <code>169.253.2.50</code>, so the ethernet interface from which the UDP packet destined for the FPGA originates must be on the same subnet. The IP address selected for the interface in this example is <code>169.253.2.100</code>.</p> <h3 id=configuring-the-arp-table>Configuring the ARP table<a class=headerlink href=#configuring-the-arp-table title="Permanent link">&para;</a></h3> <p>Whether or not you are connected to the internet, you will have to modify your ARP table so that the kernel knows where to route requests to the IP address of <code>169.253.2.50</code>. It is possible to add ARP support to the hardware via the LiteX Liteeth ARP module, but that is not included in this example, so it is necessary to manually modify the ARP table on your machine.</p> <p>On my Mac, I am connected to internet via Wi-Fi while the FPGA is plugged into Thunderbolt RJ45 ethernet. The Thunderbolt ethernet interface is listed as <code>en7</code> according to <code>ifconfig</code>, so I set the IP and subnet of <code>en7</code> accordingly. The following command syntax works on BSD as well as Linux.</p> <pre class=codehilite><code class="language-bash linenums">$ifconfig en7 169.253.2.100 netmask 255.255.255.0</code></pre> <p>Next, I configure the ARP table where <code>10:e2:d5:00:00:00</code> is the MAC address of the FPGA.</p> <h4 id=freebsdmacos>FreeBSD/MacOS<a class=headerlink href=#freebsdmacos title="Permanent link">&para;</a></h4> <pre class=codehilite><code class="language-bash linenums">$arp -s 169.253.2.50 10:e2:d5:00:00:00 ifscope en7</code></pre> <h4 id=linux>Linux<a class=headerlink href=#linux title="Permanent link">&para;</a></h4> <pre class=codehilite><code class="language-bash linenums">$arp -s 169.253.2.50 10:e2:d5:00:00:00 -iface en7</code></pre> <h2 id=sending-and-receiving-packets>Sending and Receiving Packets<a class=headerlink href=#sending-and-receiving-packets title="Permanent link">&para;</a></h2> <p>You should now be able to send and receive UDP packets.</p> <pre class=codehilite><code class="language-bash linenums">$python3 listener.py &amp;
$python3 sender.py</code></pre> <p>If everything is working correctly, you should see <code>recieved message:some message</code> as the last line of output. <img alt="loopback success" src=../loopback_success.png></p> <h2 id=debugging>Debugging<a class=headerlink href=#debugging title="Permanent link">&para;</a></h2> <p>Wireshark is a good tool that should be in every engineer's toolbox. Select the interface that you want to monitor in wireshark to help with debugging potential problems. As you can see below, the FPGA receives the packet and then queries to determine the physical ethernet address the IP packet originated from.</p> <p><img alt="Wireshark debugging" src=../wireshark.png></p> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../why_migen/ title="why migen" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Previous </span> why migen </span> </div> </a> <a href=../../verilator/why_verilator/ title="why verilator" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Next </span> why verilator </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2016 - 2020 Yehowshua Immanuel </div> powered by <a href=https://www.mkdocs.org target=_blank rel=noopener>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../../assets/fonts/font-awesome.css> <a href=https://github.com/BracketMaster target=_blank rel=noopener title=github-alt class="md-footer-social__link fa fa-github-alt"></a> <a href=https://www.linkedin.com/in/yehowshua-immanuel/ target=_blank rel=noopener title=linkedin class="md-footer-social__link fa fa-linkedin"></a> </div> </div> </div> </footer> </div> <script src=../../../assets/javascripts/application.8e081faa.js></script> <script>app.initialize({version:"1.1",url:{base:"../../.."}})</script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>